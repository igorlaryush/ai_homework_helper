window.paywall={paywallContainerId:"",shadowRoot:null,_paywallId:null,_isInitialized:!1,_initPromise:null,_eventHandlers:new Map,_paywallDocumentRoot:null,_observer:null,_overrideStyles:null,_iframeCreated:!1,_iframeCreating:!1,_userId:null,_requestCounter:0,_iframeContentWindow:null,_generateRequestId:function(){if("undefined"!=typeof crypto&&crypto.randomUUID)return crypto.randomUUID();if("undefined"!=typeof crypto&&crypto.getRandomValues){let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}return this._requestCounter++,"".concat(Date.now(),"_").concat(this._requestCounter,"_").concat(Math.random().toString(36).slice(2,11))},init:function(e){var a;return this._initPromise||(this._paywallId=e,this._paywallDocumentRoot=null!=(a=this.shadowRoot)?a:document,"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.sync&&chrome.storage.sync.get(["pw-".concat(this._paywallId,"-visitor-id")],e=>{var a;this._userId=null!=(a=e["pw-".concat(this._paywallId,"-visitor-id")])?a:null}),window.addEventListener("message",this._globalEventHandler.bind(this),!1),this._initPromise=new Promise(e=>{this._addEventHandler("init",a=>{"state"===a.data.type&&(this._isInitialized=!0,this._removeEventHandler("init"),e(!0))})})),this._initPromise},_createAndAppendIframe:function(){this._iframeCreated||this._iframeCreating||(this._iframeCreating=!0,window.requestAnimationFrame(()=>{let e=()=>{let e,a=document.createElement("iframe");a.src="https://onlineapp.pro/paywall/".concat(this._paywallId,"?v=2.1.2&containerId=").concat(this.paywallContainerId,"&ext_user_id=").concat(this._userId),a.id="paywall-".concat(this._paywallId),a.style.display="none",this.paywallContainerId?(e=this._paywallDocumentRoot.getElementById(this.paywallContainerId))||(console.warn("[PAYWALL ERROR] Specified container not found, appending to body"),e=this._paywallDocumentRoot.querySelector("body")):e=this._paywallDocumentRoot.querySelector("body"),e?(e.appendChild(a),this._iframeContentWindow=a.contentWindow,this._iframeCreated=!0,this._iframeCreating=!1):console.error("[PAYWALL ERROR] Paywall container not found")};"loading"===this._paywallDocumentRoot.readyState?this._paywallDocumentRoot.addEventListener("DOMContentLoaded",e):e()}))},_globalEventHandler:function(e){let a=!1;if(this._iframeContentWindow&&e.source===this._iframeContentWindow)a=!0;else if(this._iframeCreated){let n=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId));n&&e.source===n.contentWindow&&(a=!0)}if(!a)return;let n=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId));for(let[,a]of("change-styles"===e.data.type&&n?Object.assign(n.style,{...e.data.style,...this._overrideStyles||{}}):"redirect"===e.data.type?window.open(e.data.redirectUrl):"remove"===e.data.type&&n&&n.remove(),this._eventHandlers))a(e)},_addEventHandler:function(e,a){this._eventHandlers.set(e,a)},_removeEventHandler:function(e){this._eventHandlers.delete(e)},_ensureInitialized:async function(){return this._paywallId||this.init("680"),this._paywallId},_ensureIframeCreated:async function(){await this._ensureInitialized(),!this._iframeCreated&&(this._createAndAppendIframe(),this._isInitialized||await this._initPromise)},open:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{resolveEvent:"opened",consumeTrialOpen:!0};return await this._ensureIframeCreated(),new Promise((a,n)=>{var t;let r=this._generateRequestId(),l=t=>{var l;if((null==(l=t.data)?void 0:l.type)==="state"&&["https://onlineapp.pro","https://onlineapp.pro","https://onlineapp.live","https://onlineapp.stream"].includes(t.origin))if("invisible"===t.data.state.visibility_status&&"paid"!==t.data.state.purchase_status&&"tokenization-sign-in"!==t.data.state.visibility_status_reason)this._removeEventHandler("open_".concat(r)),n(t.data.state);else switch(e.resolveEvent){case"opened":"visible"===t.data.state.visibility_status?(this._removeEventHandler("open_".concat(r)),a(t.data.state)):"invisible"===t.data.state.visibility_status&&(this._removeEventHandler("open_".concat(r)),n(t.data.state));break;case"signed-in":"signed-in"===t.data.state.auth_status&&(this._removeEventHandler("open_".concat(r)),a(t.data.state));break;case"success-purchase":"paid"===t.data.state.purchase_status&&(this._removeEventHandler("open_".concat(r)),a(t.data.state))}};this._addEventHandler("open_".concat(r),l),null==(t=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId)))||t.contentWindow.postMessage({action:"open",consumeTrialOpen:e.consumeTrialOpen},"*")})},renew:async function(){return await this._ensureIframeCreated(),new Promise((e,a)=>{var n;let t=this._generateRequestId(),r=n=>{var r;(null==(r=n.data)?void 0:r.type)==="state"&&["https://onlineapp.pro","https://onlineapp.pro","https://onlineapp.live","https://onlineapp.stream"].includes(n.origin)&&("paid"===n.data.state.purchase_status?(this._removeEventHandler("renew_".concat(t)),e(n.data.state)):"closed-by-user"===n.data.state.visibility_status_reason&&(this._removeEventHandler("renew_".concat(t)),a(n.data.state)))};this._addEventHandler("renew_".concat(t),r),null==(n=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId)))||n.contentWindow.postMessage({action:"renew"},"*")})},getUser:async function(){return await this._ensureIframeCreated(),this.makeRequest("https://onlineapp.pro/api/v1/paywall/".concat(this._paywallId,"/user"))},signOut:async function(){return this.makeRequest("https://onlineapp.pro/api/signout",{method:"POST"})},destroy:async function(){await this._ensureIframeCreated();let e=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId));null==e||e.remove(),this._iframeCreated=!1,this._iframeContentWindow=null},setUserMetadata:async function(e){await this._ensureIframeCreated();let a=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId));null==a||a.contentWindow.postMessage({type:"SET_USER_METADATA",metadata:e},"*")},getTrialInfo:async function(){return await this._ensureIframeCreated(),new Promise((e,a)=>{let n=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId)),t=this._generateRequestId(),r=n=>{n.data.requestId===t&&(this._removeEventHandler("request_".concat(t)),n.data.error?a(n.data.error):e(n.data.response))};this._addEventHandler("request_".concat(t),r),null==n||n.contentWindow.postMessage({type:"GET_TRIAL_INFO",requestId:t},"*")})},getOfferInfo:async function(){return await this._ensureIframeCreated(),new Promise((e,a)=>{let n=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId)),t=this._generateRequestId(),r=n=>{n.data.requestId===t&&(this._removeEventHandler("request_".concat(t)),n.data.error?a(n.data.error):e(n.data.response))};this._addEventHandler("request_".concat(t),r),null==n||n.contentWindow.postMessage({type:"GET_OFFER_INFO",requestId:t},"*")})},makeRequest:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return await this._ensureIframeCreated(),new Promise((r,l)=>{let s=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId)),i=this._generateRequestId(),o=e=>{e.data.requestId===i&&(this._removeEventHandler("request_".concat(i)),e.data.error?l(e.data.error):r(e.data.response))};this._addEventHandler("request_".concat(i),o),null==s||s.contentWindow.postMessage({type:"MAKE_REQUEST",url:e,options:a,requestId:i,useFormData:t},"*"),n&&(n.abort=()=>{this._abortRequest(i)})})},makeStreamRequest:async function*(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];await this._ensureIframeCreated();let r=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId)),l=this._generateRequestId();this._addEventHandler("stream_".concat(l),e=>new Promise((a,n)=>{if(e.data.requestId===l){var t,r;(null==(r=e.data)||null==(t=r.data)?void 0:t.error)?n(e.data.data.error):a({chunk:e.data.chunk,done:e.data.done})}else a(null)})),null==r||r.contentWindow.postMessage({type:"MAKE_STREAM_REQUEST",url:e,options:a,requestId:l,useFormData:t},"*"),n&&(n.abort=()=>{this._abortRequest(l)});try{for(;;){let e=await new Promise((e,a)=>{let n=n=>{if(n.data.requestId===l){var t,r;(null==(r=n.data)||null==(t=r.data)?void 0:t.error)?a(n.data.data.error):e(n.data)}};this._addEventHandler("stream_message_".concat(l),n)});if(e.done)break;e.chunk&&(yield e.chunk)}}finally{this._removeEventHandler("stream_".concat(l)),this._removeEventHandler("stream_message_".concat(l))}},_abortRequest:function(e){var a;let n=this._paywallDocumentRoot.getElementById("paywall-".concat(this._paywallId));null==n||null==(a=n.contentWindow)||a.postMessage({type:"ABORT_REQUEST",requestId:e},"*")}}